<!DOCTYPE html>
<html>
<head>
  <title>Home Page</title>
</head>
<body>
  <h1>Welcome to the Home Page!</h1>
  <ul id="quest-list"></ul>
  <script>
    fetch('/data')
      .then(response => response.json())
      .then(data => {
        function extractQfValues(startCriterion) {
          const qfPattern = /Qf=(\d+)/g;
          let match;
          const qfValues = [];
          while ((match = qfPattern.exec(startCriterion)) !== null) {
            qfValues.push(parseInt(match[1], 10));
          }
          return qfValues;
        }

        function displayCritsQuests(item) {
          const critQuests = [];
          let ids = extractQfValues(item.startCriterion);
          
          while (ids.length > 0) {
              const id = ids.shift();
              const critQuest = data["data"].find(q => q.id === id);
              
              if (critQuest) {
                  critQuests.push(critQuest);
                  ids = ids.concat(extractQfValues(critQuest.startCriterion));
              }
          }

          if (critQuests.length > 0) {
            return critQuests.map(q => `<li>${q.name.fr}</li>`).join('');
          } else {
            return '';
          }
        }

        const list = document.getElementById('quest-list');
        console.log(data);
        data["data"].forEach(item => {
          console.log(item.startCriterion);
          const listItem = document.createElement('li');

          listItem.innerHTML = `
            <div>
              <p>name: ${item.name.fr}</p>
              <ul>
                ${ item.startCriterion.length > 0 ? displayCritsQuests(item) : '' }
              </ul>
            </div>
          `;
          list.appendChild(listItem);
        });
      })
      .catch(error => console.error('Error fetching data:', error));
  </script>
</body>
</html>
